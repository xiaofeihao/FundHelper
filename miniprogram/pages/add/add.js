"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var netService_1 = require("../../network/netService");
var util_1 = require("../../utils/util");
Page({
    data: {
        title: "",
        frontImage: "",
        totalPages: 0,
        currentPage: 0,
        lastDate: "",
        author: "",
        description: "",
        readReason: "",
        thoughts: undefined,
        reading: true,
        percent: 0,
        startPage: 0,
        endPage: 0,
        publishHouse: "",
        publishDate: "",
        openThoughtButton: false,
        pageFrom: 1,
        currentTitle: ""
    },
    onLoad: function (option) {
        console.log(option);
        if (Number(option.from) === 0) {
            if (option.errMessage) {
                this.setData({
                    pageFrom: 0
                });
                wx.showToast({
                    title: option.errMessage,
                    icon: 'none',
                    duration: 2000
                });
            }
            else {
                var pages = option.totalPages ? option.totalPages : '0';
                var length_1 = pages.length;
                if (pages.lastIndexOf('页') !== -1) {
                    pages = pages.substring(0, length_1 - 1);
                }
                this.setData({
                    title: option.title ? option.title : "",
                    author: option.author ? option.author : "",
                    frontImage: option.imageId ? netService_1.getBookImage(option.imageId) : "",
                    publishHouse: option.publishHouse ? option.publishHouse : "",
                    totalPages: Number(pages),
                    pageFrom: 0,
                    currentTitle: option.title ? option.title : "",
                });
            }
        }
        else if (Number(option.from) === 1) {
            console.log("点击手动添加进来的");
            this.setData({
                pageFrom: 1
            });
        }
        else if (Number(option.from) === 2) {
            this.setData({
                title: option.title,
                author: option.author,
                frontImage: option.frontImage ? option.frontImage : netService_1.getBookImage(option.imageId),
                publishHouse: option.publishHouse,
                totalPages: Number(option.totalPages),
                currentPage: Number(option.currentPage),
                publishDate: option.publishDate,
                lastDate: option.lastDate,
                reading: option.reading,
                readReason: option.readReason,
                startPage: Number(option.startPage),
                endPage: Number(option.endPage),
                percent: Number(option.percent),
                description: option.description,
                pageFrom: 2,
                currentTitle: option.title
            });
        }
    },
    clickImage: function () {
        var pageThis = this;
        wx.chooseImage({
            count: 1,
            sizeType: ['original', 'compressed'],
            sourceType: ['album', 'camera'],
            success: function (res) {
                pageThis.setData({
                    frontImage: res.tempFilePaths[0]
                });
            }
        });
    },
    bookNameInput: function (e) {
        this.setData({
            title: e.detail.value
        });
    },
    bookAuthorInput: function (e) {
        this.setData({
            author: e.detail.value
        });
    },
    bookTotalPageInput: function (e) {
        this.setData({
            totalPages: Number(e.detail.value)
        });
    },
    readingStatusChange: function (e) {
        this.setData({
            reading: e.detail.value
        });
    },
    bookStartInput: function (e) {
        var start = 0;
        try {
            start = Number(e.detail.value);
        }
        catch (e) {
            start = this.data.startPage;
        }
        console.log(start);
        this.setData({
            startPage: start
        });
    },
    bookEndInput: function (e) {
        var end = 0;
        try {
            end = Number(e.detail.value);
        }
        catch (e) {
            end = this.data.startPage;
        }
        console.log(end);
        this.setData({
            endPage: end
        });
    },
    bookReasonInput: function (e) {
        this.setData({
            readReason: e.detail.value
        });
    },
    bookPublishHouseInput: function (e) {
        this.setData({
            publishHouse: e.detail.value
        });
    },
    bookPublishDateInput: function (e) {
        this.setData({
            publishDate: e.detail.value
        });
    },
    bookDescriptionInput: function (e) {
        this.setData({
            description: e.detail.value
        });
    },
    clickUpdateSave: function () {
        var _this = this;
        var tempPercent = 0;
        var tempPages = this.data.endPage - this.data.startPage;
        console.log(tempPages);
        if (this.data.totalPages !== 0) {
            tempPercent = tempPages * 100 / this.data.totalPages;
        }
        var tempCurrent = this.data.currentPage + tempPages;
        var date = util_1.formatTime(new Date());
        var book = {
            title: this.data.title,
            frontImage: this.data.frontImage,
            author: this.data.author,
            totalPages: this.data.totalPages,
            readReason: this.data.readReason,
            reading: this.data.reading,
            currentPage: tempCurrent,
            lastDate: date,
            description: this.data.description,
            thoughts: this.data.thoughts,
            percent: tempPercent,
            startPage: this.data.startPage,
            endPage: this.data.endPage,
            publishDate: this.data.publishDate,
            publishHouse: this.data.publishHouse
        };
        var errMessage = util_1.isBookInfoAvailable(book);
        if (errMessage) {
            wx.showToast({
                title: errMessage,
                icon: 'none',
                duration: 2000
            });
        }
        else {
            console.log(book);
            wx.showLoading({
                title: "正在保存...",
                mask: true
            });
            var books_1 = wx.getStorageSync("books");
            if (books_1) {
                if (this.data.pageFrom === 2) {
                    books_1 = books_1.filter(function (value) { return value.title !== _this.data.currentTitle; });
                    books_1.push(book);
                    this.saveBooks(books_1);
                    return;
                }
                var tempBook_1 = books_1.filter(function (value) { return value.title === _this.data.currentTitle; });
                if (tempBook_1.length > 0) {
                    wx.hideLoading();
                    wx.showModal({
                        title: "同名提示",
                        content: "“" + book.title + "”已经存在，是否覆盖？",
                        success: function (res) {
                            if (res.confirm) {
                                wx.showLoading({
                                    title: "正在保存...",
                                    mask: true
                                });
                                books_1 = books_1.filter(function (value) { return value.title !== tempBook_1[0].title; });
                                books_1.push(book);
                                _this.saveBooks(books_1);
                            }
                        }
                    });
                }
                else {
                    books_1.push(book);
                    this.saveBooks(books_1);
                }
            }
            else {
                books_1 = [];
                books_1.push(book);
                this.saveBooks(books_1);
            }
        }
    },
    saveBooks: function (books) {
        var tempBooks = books.reverse();
        wx.setStorage({
            key: "books",
            data: tempBooks,
            success: function () {
                wx.hideLoading();
                wx.navigateBack({
                    delta: 1
                });
            },
            fail: function () {
                wx.hideLoading();
                wx.showToast({
                    title: "保存失败",
                    icon: "none",
                    duration: 2000
                });
            }
        });
    },
    clickDelete: function () {
        var _this = this;
        wx.showModal({
            title: "删除",
            content: "确定要删除吗？",
            success: function (res) {
                if (res.confirm) {
                    var books = wx.getStorageSync("books");
                    if (books) {
                        books = books.filter(function (value) { return value.title !== _this.data.currentTitle; });
                        _this.saveBooks(books);
                    }
                }
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYWRkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsdURBQXVEO0FBQ3ZELHlDQUFrRTtBQUdsRSxJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixLQUFLLEVBQUUsRUFBRTtRQUNULFVBQVUsRUFBRSxFQUFFO1FBQ2QsVUFBVSxFQUFFLENBQUM7UUFDYixXQUFXLEVBQUUsQ0FBQztRQUNkLFFBQVEsRUFBRSxFQUFFO1FBQ1osTUFBTSxFQUFFLEVBQUU7UUFDVixXQUFXLEVBQUUsRUFBRTtRQUNmLFVBQVUsRUFBRSxFQUFFO1FBQ2QsUUFBUSxFQUFFLFNBQVM7UUFDbkIsT0FBTyxFQUFFLElBQUk7UUFDYixPQUFPLEVBQUUsQ0FBQztRQUNWLFNBQVMsRUFBRSxDQUFDO1FBQ1osT0FBTyxFQUFFLENBQUM7UUFDVixZQUFZLEVBQUUsRUFBRTtRQUNoQixXQUFXLEVBQUUsRUFBRTtRQUNmLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsUUFBUSxFQUFFLENBQUM7UUFDWCxZQUFZLEVBQUUsRUFBRTtLQUNqQjtJQUNELE1BQU0sRUFBTixVQUFPLE1BQVc7UUFDaEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwQixJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBRTdCLElBQUksTUFBTSxDQUFDLFVBQVUsRUFBRTtnQkFFckIsSUFBSSxDQUFDLE9BQVEsQ0FBQztvQkFDWixRQUFRLEVBQUUsQ0FBQztpQkFDWixDQUFDLENBQUE7Z0JBQ0YsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsTUFBTSxDQUFDLFVBQVU7b0JBQ3hCLElBQUksRUFBRSxNQUFNO29CQUNaLFFBQVEsRUFBRSxJQUFJO2lCQUNmLENBQUMsQ0FBQTthQUNIO2lCQUFNO2dCQUNMLElBQUksS0FBSyxHQUFXLE1BQU0sQ0FBQyxVQUFVLENB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QyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsT0FBTztZQUNaLElBQUksRUFBRSxTQUFTO1lBQ2YsT0FBTyxFQUFFO2dCQUNQLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakIsRUFBRSxDQUFDLFlBQVksQ0FBQztvQkFDZCxLQUFLLEVBQUUsQ0FBQztpQkFDVCxDQUFDLENBQUE7WUFDSixDQUFDO1lBQ0QsSUFBSSxFQUFFO2dCQUNKLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakIsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsTUFBTTtvQkFDYixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsSUFBSTtpQkFDZixDQUFDLENBQUM7WUFDTCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELFdBQVcsRUFBWDtRQUFBLGlCQWNDO1FBYkMsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNYLEtBQUssRUFBRSxJQUFJO1lBQ1gsT0FBTyxFQUFFLFNBQVM7WUFDbEIsT0FBTyxFQUFFLFVBQUMsR0FBRztnQkFDWCxJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUU7b0JBQ2YsSUFBSSxLQUFLLEdBQWdCLEVBQUUsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3BELElBQUksS0FBSyxFQUFFO3dCQUNULEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLEtBQUssS0FBSyxLQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBdEMsQ0FBc0MsQ0FBQyxDQUFDO3dCQUN0RSxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO3FCQUN2QjtpQkFDRjtZQUNILENBQUM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0Qm9va0ltYWdlIH0gZnJvbSAnLi4vLi4vbmV0d29yay9uZXRTZXJ2aWNlJ1xuaW1wb3J0IHsgaXNCb29rSW5mb0F2YWlsYWJsZSwgZm9ybWF0VGltZSB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnXG5pbXBvcnQgeyBCb29rIH0gZnJvbSAnLi4vLi4vZGF0YS9kYXRhTW9kZWwnXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgdGl0bGU6IFwiXCIsIC8vIOS5puWQjVxuICAgIGZyb250SW1hZ2U6IFwiXCIsIC8vIOWbvueJh1xuICAgIHRvdGFsUGFnZXM6IDAsIC8vIOaAu+mhteaVsFxuICAgIGN1cnJlbnRQYWdlOiAwLCAvLyDlvZPliY3pmIXor7vnmoTpobXmlbBcbiAgICBsYXN0RGF0ZTogXCJcIiwgLy8g5pyA5paw5pu05paw5pe26Ze0IOW5tC3mnIgt5pelXG4gICAgYXV0aG9yOiBcIlwiLCAvLyDkvZzogIVcbiAgICBkZXNjcmlwdGlvbjogXCJcIiwgLy8g566A5LuLXG4gICAgcmVhZFJlYXNvbjogXCJcIiwgLy8g5Yid5b+D77yM6ZiF6K+755CG55SxXG4gICAgdGhvdWdodHM6IHVuZGVmaW5lZCwgLy8g5oSf5oOzXG4gICAgcmVhZGluZzogdHJ1ZSwgLy8g5piv5ZCm5Zyo6K+7XG4gICAgcGVyY2VudDogMCwgLy8g5b2T5YmN6L+b5bqmXG4gICAgc3RhcnRQYWdlOiAwLFxuICAgIGVuZFBhZ2U6IDAsXG4gICAgcHVibGlzaEhvdXNlOiBcIlwiLFxuICAgIHB1Ymxpc2hEYXRlOiBcIlwiLFxuICAgIG9wZW5UaG91Z2h0QnV0dG9uOiBmYWxzZSxcbiAgICBwYWdlRnJvbTogMSxcbiAgICBjdXJyZW50VGl0bGU6IFwiXCIgLy8g5Yig6Zmk5pe255SoXG4gIH0sXG4gIG9uTG9hZChvcHRpb246IGFueSkge1xuICAgIGNvbnNvbGUubG9nKG9wdGlvbik7XG4gICAgaWYgKE51bWJlcihvcHRpb24uZnJvbSkgPT09IDApIHtcbiAgICAgIC8vIOaJq+eggei/h+adpeeahFxuICAgICAgaWYgKG9wdGlvbi5lcnJNZXNzYWdlKSB7XG4gICAgICAgIC8vIOivtOaYjuaciemUmeivr1xuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICBwYWdlRnJvbTogMFxuICAgICAgICB9KVxuICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgIHRpdGxlOiBvcHRpb24uZXJyTWVzc2FnZSxcbiAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBwYWdlczogc3RyaW5nID0gb3B0aW9uLnRvdGFsUGFnZXMgPyBvcHRpb24udG90YWxQYWdlcyA6ICcwJztcbiAgICAgICAgbGV0IGxlbmd0aDogbnVtYmVyID0gcGFnZXMubGVuZ3RoO1xuICAgICAgICBpZiAocGFnZXMubGFzdEluZGV4T2YoJ+mhtScpICE9PSAtMSkge1xuICAgICAgICAgIHBhZ2VzID0gcGFnZXMuc3Vic3RyaW5nKDAsIGxlbmd0aCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgIHRpdGxlOiBvcHRpb24udGl0bGUgPyBvcHRpb24udGl0bGUgOiBcIlwiLFxuICAgICAgICAgIGF1dGhvcjogb3B0aW9uLmF1dGhvciA/IG9wdGlvbi5hdXRob3IgOiBcIlwiLFxuICAgICAgICAgIGZyb250SW1hZ2U6IG9wdGlvbi5pbWFnZUlkID8gZ2V0Qm9va0ltYWdlKG9wdGlvbi5pbWFnZUlkKSA6IFwiXCIsXG4gICAgICAgICAgcHVibGlzaEhvdXNlOiBvcHRpb24ucHVibGlzaEhvdXNlID8gb3B0aW9uLnB1Ymxpc2hIb3VzZSA6IFwiXCIsXG4gICAgICAgICAgdG90YWxQYWdlczogTnVtYmVyKHBhZ2VzKSxcbiAgICAgICAgICBwYWdlRnJvbTogMCxcbiAgICAgICAgICBjdXJyZW50VGl0bGU6IG9wdGlvbi50aXRsZSA/IG9wdGlvbi50aXRsZSA6IFwiXCIsXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChOdW1iZXIob3B0aW9uLmZyb20pID09PSAxKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIueCueWHu+aJi+WKqOa3u+WKoOi/m+adpeeahFwiKVxuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHBhZ2VGcm9tOiAxXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAoTnVtYmVyKG9wdGlvbi5mcm9tKSA9PT0gMikge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHRpdGxlOiBvcHRpb24udGl0bGUsXG4gICAgICAgIGF1dGhvcjogb3B0aW9uLmF1dGhvcixcbiAgICAgICAgZnJvbnRJbWFnZTogb3B0aW9uLmZyb250SW1hZ2UgPyBvcHRpb24uZnJvbnRJbWFnZSA6IGdldEJvb2tJbWFnZShvcHRpb24uaW1hZ2VJZCksXG4gICAgICAgIHB1Ymxpc2hIb3VzZTogb3B0aW9uLnB1Ymxpc2hIb3VzZSxcbiAgICAgICAgdG90YWxQYWdlczogTnVtYmVyKG9wdGlvbi50b3RhbFBhZ2VzKSxcbiAgICAgICAgY3VycmVudFBhZ2U6IE51bWJlcihvcHRpb24uY3VycmVudFBhZ2UpLFxuICAgICAgICBwdWJsaXNoRGF0ZTogb3B0aW9uLnB1Ymxpc2hEYXRlLFxuICAgICAgICBsYXN0RGF0ZTogb3B0aW9uLmxhc3REYXRlLFxuICAgICAgICByZWFkaW5nOiBvcHRpb24ucmVhZGluZyxcbiAgICAgICAgcmVhZFJlYXNvbjogb3B0aW9uLnJlYWRSZWFzb24sXG4gICAgICAgIHN0YXJ0UGFnZTogTnVtYmVyKG9wdGlvbi5zdGFydFBhZ2UpLFxuICAgICAgICBlbmRQYWdlOiBOdW1iZXIob3B0aW9uLmVuZFBhZ2UpLFxuICAgICAgICBwZXJjZW50OiBOdW1iZXIob3B0aW9uLnBlcmNlbnQpLFxuICAgICAgICBkZXNjcmlwdGlvbjogb3B0aW9uLmRlc2NyaXB0aW9uLFxuICAgICAgICBwYWdlRnJvbTogMixcbiAgICAgICAgY3VycmVudFRpdGxlOiBvcHRpb24udGl0bGVcbiAgICAgIH0pXG4gICAgfVxuXG4gIH0sXG4gIGNsaWNrSW1hZ2UoKSB7XG4gICAgY29uc3QgcGFnZVRoaXMgPSB0aGlzO1xuICAgIHd4LmNob29zZUltYWdlKHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgc2l6ZVR5cGU6IFsnb3JpZ2luYWwnLCAnY29tcHJlc3NlZCddLFxuICAgICAgc291cmNlVHlwZTogWydhbGJ1bScsICdjYW1lcmEnXSxcbiAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgIC8vIHRlbXBGaWxlUGF0aOWPr+S7peS9nOS4umltZ+agh+etvueahHNyY+WxnuaAp+aYvuekuuWbvueJh1xuICAgICAgICBwYWdlVGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgZnJvbnRJbWFnZTogcmVzLnRlbXBGaWxlUGF0aHNbMF1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIGJvb2tOYW1lSW5wdXQ6IGZ1bmN0aW9uIChlOiBhbnkpIHtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHRpdGxlOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIGJvb2tBdXRob3JJbnB1dDogZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgYXV0aG9yOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIGJvb2tUb3RhbFBhZ2VJbnB1dDogZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgdG90YWxQYWdlczogTnVtYmVyKGUuZGV0YWlsLnZhbHVlKVxuICAgIH0pXG4gIH0sXG4gIHJlYWRpbmdTdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uIChlOiBhbnkpIHtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHJlYWRpbmc6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcbiAgYm9va1N0YXJ0SW5wdXQ6IGZ1bmN0aW9uIChlOiBhbnkpIHtcbiAgICBsZXQgc3RhcnQ6IG51bWJlciA9IDA7XG4gICAgdHJ5IHtcbiAgICAgIHN0YXJ0ID0gTnVtYmVyKGUuZGV0YWlsLnZhbHVlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBzdGFydCA9IHRoaXMuZGF0YS5zdGFydFBhZ2U7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKHN0YXJ0KTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHN0YXJ0UGFnZTogc3RhcnRcbiAgICB9KVxuICB9LFxuICBib29rRW5kSW5wdXQ6IGZ1bmN0aW9uIChlOiBhbnkpIHtcbiAgICBsZXQgZW5kOiBudW1iZXIgPSAwO1xuICAgIHRyeSB7XG4gICAgICBlbmQgPSBOdW1iZXIoZS5kZXRhaWwudmFsdWUpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGVuZCA9IHRoaXMuZGF0YS5zdGFydFBhZ2U7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGVuZCk7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBlbmRQYWdlOiBlbmRcbiAgICB9KVxuICB9LFxuICBib29rUmVhc29uSW5wdXQ6IGZ1bmN0aW9uIChlOiBhbnkpIHtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHJlYWRSZWFzb246IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcbiAgYm9va1B1Ymxpc2hIb3VzZUlucHV0OiBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwdWJsaXNoSG91c2U6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcbiAgYm9va1B1Ymxpc2hEYXRlSW5wdXQ6IGZ1bmN0aW9uIChlOiBhbnkpIHtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHB1Ymxpc2hEYXRlOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIGJvb2tEZXNjcmlwdGlvbklucHV0OiBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBkZXNjcmlwdGlvbjogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuICBjbGlja1VwZGF0ZVNhdmUoKSB7XG4gICAgLy8g5L+d5a2Y5Lmm57GN5L+h5oGvXG4gICAgbGV0IHRlbXBQZXJjZW50ID0gMDtcbiAgICBsZXQgdGVtcFBhZ2VzOiBudW1iZXIgPSB0aGlzLmRhdGEuZW5kUGFnZSAtIHRoaXMuZGF0YS5zdGFydFBhZ2U7XG4gICAgY29uc29sZS5sb2codGVtcFBhZ2VzKTtcbiAgICBpZiAodGhpcy5kYXRhLnRvdGFsUGFnZXMgIT09IDApIHtcbiAgICAgIHRlbXBQZXJjZW50ID0gdGVtcFBhZ2VzICogMTAwIC8gdGhpcy5kYXRhLnRvdGFsUGFnZXM7XG4gICAgfVxuICAgIGxldCB0ZW1wQ3VycmVudDogbnVtYmVyID0gdGhpcy5kYXRhLmN1cnJlbnRQYWdlICsgdGVtcFBhZ2VzO1xuICAgIGxldCBkYXRlOiBzdHJpbmcgPSBmb3JtYXRUaW1lKG5ldyBEYXRlKCkpO1xuICAgIGNvbnN0IGJvb2s6IEJvb2sgPSB7XG4gICAgICB0aXRsZTogdGhpcy5kYXRhLnRpdGxlLFxuICAgICAgZnJvbnRJbWFnZTogdGhpcy5kYXRhLmZyb250SW1hZ2UsXG4gICAgICBhdXRob3I6IHRoaXMuZGF0YS5hdXRob3IsXG4gICAgICB0b3RhbFBhZ2VzOiB0aGlzLmRhdGEudG90YWxQYWdlcyxcbiAgICAgIHJlYWRSZWFzb246IHRoaXMuZGF0YS5yZWFkUmVhc29uLFxuICAgICAgcmVhZGluZzogdGhpcy5kYXRhLnJlYWRpbmcsXG4gICAgICBjdXJyZW50UGFnZTogdGVtcEN1cnJlbnQsXG4gICAgICBsYXN0RGF0ZTogZGF0ZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRhdGEuZGVzY3JpcHRpb24sXG4gICAgICB0aG91Z2h0czogdGhpcy5kYXRhLnRob3VnaHRzLFxuICAgICAgcGVyY2VudDogdGVtcFBlcmNlbnQsXG4gICAgICBzdGFydFBhZ2U6IHRoaXMuZGF0YS5zdGFydFBhZ2UsXG4gICAgICBlbmRQYWdlOiB0aGlzLmRhdGEuZW5kUGFnZSxcbiAgICAgIHB1Ymxpc2hEYXRlOiB0aGlzLmRhdGEucHVibGlzaERhdGUsXG4gICAgICBwdWJsaXNoSG91c2U6IHRoaXMuZGF0YS5wdWJsaXNoSG91c2VcbiAgICB9XG4gICAgbGV0IGVyck1lc3NhZ2UgPSBpc0Jvb2tJbmZvQXZhaWxhYmxlKGJvb2spO1xuICAgIGlmIChlcnJNZXNzYWdlKSB7XG4gICAgICAvLyDmnInpl67popjvvIzlvLnlh7p0b2FzdOaPkOekulxuICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgdGl0bGU6IGVyck1lc3NhZ2UsXG4gICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDmsqHmnInpl67popjvvIzlj6/ku6Xkv53lrZhcbiAgICAgIGNvbnNvbGUubG9nKGJvb2spO1xuICAgICAgd3guc2hvd0xvYWRpbmcoe1xuICAgICAgICB0aXRsZTogXCLmraPlnKjkv53lrZguLi5cIixcbiAgICAgICAgbWFzazogdHJ1ZVxuICAgICAgfSk7XG4gICAgICBsZXQgYm9va3M6IEFycmF5PEJvb2s+ID0gd3guZ2V0U3RvcmFnZVN5bmMoXCJib29rc1wiKTtcbiAgICAgIGlmIChib29rcykge1xuICAgICAgICBpZiAodGhpcy5kYXRhLnBhZ2VGcm9tID09PSAyKSB7XG4gICAgICAgICAgLy8g6K+05piO5piv57yW6L6RXG4gICAgICAgICAgYm9va3MgPSBib29rcy5maWx0ZXIodmFsdWUgPT4gdmFsdWUudGl0bGUgIT09IHRoaXMuZGF0YS5jdXJyZW50VGl0bGUpO1xuICAgICAgICAgIGJvb2tzLnB1c2goYm9vayk7XG4gICAgICAgICAgdGhpcy5zYXZlQm9va3MoYm9va3MpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGVtcEJvb2s6IEFycmF5PEJvb2s+ID0gYm9va3MuZmlsdGVyKHZhbHVlID0+IHZhbHVlLnRpdGxlID09PSB0aGlzLmRhdGEuY3VycmVudFRpdGxlKTtcbiAgICAgICAgaWYgKHRlbXBCb29rLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICB0aXRsZTogXCLlkIzlkI3mj5DnpLpcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IFwi4oCcXCIgKyBib29rLnRpdGxlICsgXCLigJ3lt7Lnu4/lrZjlnKjvvIzmmK/lkKbopobnm5bvvJ9cIixcbiAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgICAgICAgICAgd3guc2hvd0xvYWRpbmcoe1xuICAgICAgICAgICAgICAgICAgdGl0bGU6IFwi5q2j5Zyo5L+d5a2YLi4uXCIsXG4gICAgICAgICAgICAgICAgICBtYXNrOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYm9va3MgPSBib29rcy5maWx0ZXIodmFsdWUgPT4gdmFsdWUudGl0bGUgIT09IHRlbXBCb29rWzBdLnRpdGxlKTtcbiAgICAgICAgICAgICAgICBib29rcy5wdXNoKGJvb2spO1xuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUJvb2tzKGJvb2tzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJvb2tzLnB1c2goYm9vayk7XG4gICAgICAgICAgdGhpcy5zYXZlQm9va3MoYm9va3MpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBib29rcyA9IFtdO1xuICAgICAgICBib29rcy5wdXNoKGJvb2spO1xuICAgICAgICB0aGlzLnNhdmVCb29rcyhib29rcyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzYXZlQm9va3MoYm9va3M6IEFycmF5PEJvb2s+KSB7XG4gICAgbGV0IHRlbXBCb29rczogQXJyYXk8Qm9vaz4gPSBib29rcy5yZXZlcnNlKCk7XG4gICAgd3guc2V0U3RvcmFnZSh7XG4gICAgICBrZXk6IFwiYm9va3NcIixcbiAgICAgIGRhdGE6IHRlbXBCb29rcyxcbiAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICBkZWx0YTogMVxuICAgICAgICB9KVxuICAgICAgfSxcbiAgICAgIGZhaWw6ICgpID0+IHtcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICB0aXRsZTogXCLkv53lrZjlpLHotKVcIixcbiAgICAgICAgICBpY29uOiBcIm5vbmVcIixcbiAgICAgICAgICBkdXJhdGlvbjogMjAwMFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBjbGlja0RlbGV0ZSgpIHtcbiAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgdGl0bGU6IFwi5Yig6ZmkXCIsXG4gICAgICBjb250ZW50OiBcIuehruWumuimgeWIoOmZpOWQl++8n1wiLFxuICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICBsZXQgYm9va3M6IEFycmF5PEJvb2s+ID0gd3guZ2V0U3RvcmFnZVN5bmMoXCJib29rc1wiKTtcbiAgICAgICAgICBpZiAoYm9va3MpIHtcbiAgICAgICAgICAgIGJvb2tzID0gYm9va3MuZmlsdGVyKHZhbHVlID0+IHZhbHVlLnRpdGxlICE9PSB0aGlzLmRhdGEuY3VycmVudFRpdGxlKTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZUJvb2tzKGJvb2tzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSkiXX0=